#+begin_html
<h1 align="center">d12frosted environment / Emacs</h1>
<p align="center">
  <a href="https://github.com/d12frosted/environment/actions?query=workflow%3AEmacs">
    <img src="https://github.com/d12frosted/environment/workflows/Emacs/badge.svg" alt="Emacs Status Badge">
  </a>
</p>
#+end_html

Personal frustration and the biggest time waster in my life (comparable to video
games). Please, turn away and retain your sanity. Otherwise you might end up
tracking all your tasks, notes, thoughts and wine in Emacs.

* Overview

This Emacs configuration is designed with the following goals:

1. *Fast loading* - Less than a second startup time
2. *Clean compilation* - Byte compilation succeeds without warnings
3. *Passing lints* - All code passes style checks
4. *Testable* - Ability to write and run tests
5. *Extensible* - Easy to add personal libraries and applications

** Technology Stack

- *Package Manager*: [[https://github.com/progfolio/elpaca][elpaca]] - Fast, asynchronous installation from ELPA, MELPA, and git repositories
- *Build System*: [[https://github.com/doublep/eldev/][Eldev]] - Manages bootstrapping, autoloads, compilation, linting, and testing
- *Setup Script*: =./setup.sh= - Unified interface for all operations
- *Testing Framework*: [[https://github.com/jorgenschaefer/emacs-buttercup][buttercup]]

* Installation

** Quick Start

From the dotfiles root:

#+begin_src bash
# Install Emacs configuration and all packages
./bootstrap.sh install emacs

# Or from the emacs directory directly
cd emacs
./setup.sh install
#+end_src

** Requirements

- Emacs 29.1 or higher
- Eldev (automatically installed by =setup.sh= if not present)

** Available Commands

The =setup.sh= script provides:

| Command   | Description                              |
|-----------+------------------------------------------|
| install   | Bootstrap packages and generate autoloads |
| upgrade   | Upgrade all packages                     |
| compile   | Byte-compile all Emacs Lisp files        |
| lint      | Run linters (checkdoc, regexp)           |
| test      | Run test suite                           |
| clean     | Remove generated files                   |
| doctor    | Health check for configuration           |

#+begin_src bash
# Multiple commands can be chained
./setup.sh compile lint test

# Or use make
make install
make lint
make doctor
#+end_src

* Configuration Structure

** File Organization

All configuration files live in =lisp/= and are organized into three categories:

*** =init-*.el= - Feature Configurations

Configure built-in and external packages via =use-package=.

- Must avoid eagerly loading packages (use lazy loading)
- All =init= files are required by =init.el=
- Can require other =init= and =config= files
- Examples: =init-editor.el=, =init-ui.el=, =init-org.el=

*** =config-*.el= - Configuration Constants

Contain variables and constants.

- Safe to require from anywhere (minimal loading impact)
- No package loading or heavy computation
- Example: =config-path.el=

*** =lib-*.el= - Autoloaded Libraries

Personal libraries and utilities.

- *Should not* be required directly
- Loaded automatically via generated autoloads
- Can freely require packages for byte-compilation
- Public functions marked with =;;;###autoload=
- Examples: =lib-vulpea.el=, =lib-vino.el=, =lib-brb.el=

** Example: Creating a Library

#+begin_src emacs-lisp
;;; lib-my-feature.el --- My custom feature -*- lexical-binding: t; -*-

(require 'dash)  ; OK to require dependencies in lib files

;;;###autoload
(defun my-feature-do-something ()
  "This function is automatically available everywhere."
  (interactive)
  (-map #'upcase '("hello" "world")))

(provide 'lib-my-feature)
;;; lib-my-feature.el ends here
#+end_src

After creating the file:
1. Run =./setup.sh install= to regenerate autoloads
2. Function =my-feature-do-something= is now available globally

* Development Workflow

** Eldev Integration

[[https://github.com/doublep/eldev/][Eldev]] manages the development lifecycle. The =Eldev= file configures:

*** Build Process

#+begin_src bash
./setup.sh install
#+end_src

1. Bootstraps elpaca
2. Installs all packages via =use-package= declarations
3. Generates =init-autoloads.el= from =lib-*.el= files
4. Byte-compiles with warnings as errors

*** Linting

#+begin_src bash
./setup.sh lint
#+end_src

Runs two linters:
- *checkdoc* - Documentation style (docstrings, formatting)
- *regexp* - Regular expression validation

*Note*: =package-lint= is deliberately disabled because it's designed for ELPA
packages, not personal configurations. It expects package.el conventions like
prefix naming that don't make sense here.

Configuration details:
- =.dir-locals.el= enforces =byte-compile-error-on-warn=
- =lisp/= directory is added to load-path during linting
- =init-*.el= files can find each other without errors
- Non-standard separators allowed (e.g., =vino/germany/wein=)

*** Testing

#+begin_src bash
./setup.sh test
#+end_src

Runs [[https://github.com/jorgenschaefer/emacs-buttercup][buttercup]] test suite.

** In-Editor Flycheck

The configuration includes smart flycheck integration:

- *Auto-detects Eldev projects* via =Eldev= file
- *Adds =lisp/= to load-path* so =init-*.el= files can find each other
- *Includes elpaca packages* so =lib-*.el= files can find dependencies

This eliminates false errors:
- =(require 'config-path)= in =init-ide.el= ✓
- =(require 'dash)= in =lib-brb.el= ✓
- Using =org-roam= functions in =lib-vulpea.el= ✓

The flycheck checker used is the standard =emacs-lisp= checker with an enhanced
load-path, not =emacs-lisp-eldev= (which doesn't work well with elpaca-based
configurations).

** Common Tasks

*** Adding a Package

#+begin_src emacs-lisp
;; In any init-*.el file
(use-package helpful
  :ensure t
  :bind (("C-h f" . helpful-callable)
         ("C-h v" . helpful-variable)))
#+end_src

Restart Emacs or =M-x eval-buffer=.

*** Verifying Changes

#+begin_src bash
# Recommended workflow
./setup.sh compile lint test

# Just compilation
./setup.sh compile

# Health check
./setup.sh doctor
#+end_src

*** Upgrading Packages

#+begin_src bash
# Via setup script
./setup.sh upgrade

# Via eru
./bootstrap.sh upgrade emacs
#+end_src

** Troubleshooting

*** Flycheck: "Cannot open load file"

1. Install packages: =./setup.sh install=
2. Restart Emacs
3. Check diagnostics: =M-x flycheck-verify-setup=

*** Byte-compilation Fails

1. Verify autoloads exist: =ls lisp/init-autoloads.el=
2. Check =use-package= declarations have =:ensure t=
3. Clean rebuild: =./setup.sh clean install=

*** Linter Reports Errors

The linter only checks:
- Documentation style (checkdoc)
- Regexp syntax

It does *not* check:
- Package.el naming conventions (=package-lint= is disabled)
- Prefix requirements
- File headers

If you see package-lint-style errors about prefixes or naming, something is
misconfigured.

* Interesting Features

** Dynamic Org Agenda

With 10k+ org files, building =org-agenda-files= by scanning all files is slow.
This configuration dynamically builds the agenda file list by:

1. Marking files with =project= tag when they contain TODOs
2. Querying only tagged files using =org-roam= database
3. Updating =org-agenda-files= before running agenda

Read more at [[https://d12frosted.io/posts/2021-01-16-task-management-with-roam-vol5.html][d12frosted.io]].

*Implementation*:
- =lib-vulpea-agenda.el= - =vulpea-agenda-files-update=
- =lib-vulpea.el= - =vulpea-ensure-filetag=, =vulpea-project-files=
- =init-vulpea.el= - Hooks setup

** Meeting Capture Flow

Intelligent meeting note capture that prompts for a person and creates notes
under =Meetings= outline in their file.

Read more at [[https://d12frosted.io/posts/2021-05-21-task-management-with-roam-vol7.html][d12frosted.io]].

*Implementation*:
- =lib-vulpea-capture.el= - =vulpea-capture-meeting-template=, =vulpea-capture-meeting-target=

** Litnotes Management

#+begin_html
<p align="center">
  <img src="images/litnotes-1.png" width="48%"/>
  <img src="images/litnotes-2.png" width="48%"/>
</p>
#+end_html

Reading notes management using [[https://github.com/publicimageltd/lister][lister]], [[https://github.com/d12frosted/vulpea][vulpea]], and [[https://github.com/org-roam/org-roam/][org-roam]].

Features:
- List all reading notes grouped by status
- Configurable faces
- Tab expansion to show/hide groups
- Visit notes (=TAB= in other window, =RET= in current)
- Assign status (=s= by default)

*Entry point*: =M-x litnotes= (see =lib-litnotes.el=)

** Wine Tracking (vino)

The [[https://github.com/d12frosted/vino][vino]] library tracks wine tasting notes. Personal extensions here include:

*** Inventory Management

#+begin_html
<p align="center">
  <img src="images/vino-inventory.png" width="50%"/>
</p>
#+end_html

Using [[https://hledger.org][hledger]] to track wine cellar inventory.

*Implementation*: =lib-inventory.el=, =vino-balance-display= in =lib-vino.el=

*** Statistics

#+begin_html
<p align="center">
  <img src="images/vino-stats.png" width="100%"/>
</p>
#+end_html

Consumption statistics over custom or predefined periods:
- General stats (consumption, ratings, prices, QPR)
- Per country, vintage, colour, carbonation
- Complete rating lists

Used to generate wine tasting reports for Barberry Garden events (see
[[https://www.dropbox.com/sh/k91o9gwjvxwamoy/AAA-z_sM04W2zOACS6Ul0UnIa?dl=0][Dropbox]]).

*Implementation*: =lib-vino-stats.el=
