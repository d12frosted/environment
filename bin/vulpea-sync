#!/usr/bin/env bash

set -e

VULPEA_DIR="${VULPEA_DIR:-$HOME/vulpea}"

log() {
  echo "[$(date '+%Y-%m-%d %H:%M:%S')] $*"
}

cd "$VULPEA_DIR"

log "Syncing vulpea notes in $VULPEA_DIR"

git config user.name "Golem"
git config user.email "golem@d12frosted.io"

git add .
if git diff-index --quiet --cached HEAD --; then
  log "Nothing to commit"
else
  git commit -m "[$(date '+%d/%m/%y %H:%M:%S')] sync"
  log "Committed changes"
fi

log "Fetching from origin..."
git fetch origin

log "Rebasing on origin/master..."
git rebase origin/master

log "Pushing to origin..."
git push origin master

log "Sync complete"
